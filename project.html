<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Project Details</title>
  <link rel="stylesheet" href="project.css" />
</head>

<body>
  <button id="back-button">← Back</button>

  <div id="project-details">
    <h1 id="project-title"></h1>
    <img id="project-image" src="" alt="Project Image" style="display: none;" />

    <div id="project-content">
      <h2 id="overview-title" style="display: none;">Overview</h2>
      <p id="project-description"></p>

      <h2 id="role-title" style="display: none;">Role</h2>
      <ul id="project-role"></ul>

      <h2 id="features-title" style="display: none;">Key Features</h2>
      <ul id="project-features"></ul>

      <h2 id="challenges-title" style="display: none;">Challenges & Solutions</h2>
      <ul id="project-challenges"></ul>

      <h2 id="objectives-title" style="display: none;">Project Objectives</h2>
      <ul id="project-objectives"></ul>

      <h2 id="versions-title" class="hidden">Different Versions</h2>
      <ul id="project-versions"></ul>

      <h2 id="process-title" style="display: none;">Process & Approach</h2>
      <ul id="project-process"></ul>

      <h2 id="tech-title" style="display: none;">Programs</h2>
      <ul id="project-tech"></ul>

      <h2 id="impact-title" style="display: none;">Projected Impact</h2>
      <ul id="project-impact"></ul>

      <h2 id="date-title" style="display: none;">Project Date</h2>
      <p id="project-date"></p>
    </div>

    <div id="project-links">
      <a id="project-demo" href="#" target="_blank" style="display: none;">Preview</a>
      <a id="project-details" href="#" target="_blank" style="display: none;">Details</a>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const urlParams = new URLSearchParams(window.location.search);
      const projectId = parseInt(urlParams.get("id"), 10);

      console.log("Project ID from URL:", projectId);

      fetch("db.json")
        .then(response => response.json())
        .then(data => {
          const project = data.projects.find(p => p.id === projectId);
          console.log("Project Data Loaded:", project);

          if (project) {
            document.getElementById("project-title").innerText = project.title || "No Title Available";

            const projectImage = document.getElementById("project-image");
            if (project.image) {
              projectImage.src = project.image;
              projectImage.loading = "lazy";
              projectImage.style.display = "block";
            } else {
              projectImage.src = "Assets/default-placeholder.png";
              projectImage.style.display = "block";
            }

            const fields = [
              { id: "project-description", value: project.description, titleId: "overview-title" },
              { id: "project-date", value: project.date, titleId: "date-title" }
            ];

            fields.forEach(({ id, value, titleId }) => {
              if (value) {
                document.getElementById(id).innerText = value;
                document.getElementById(titleId).style.display = "block";
              } else {
                document.getElementById(titleId).style.display = "none";
              }
            });

            const listFields = [
              { id: "project-role", value: project.role, titleId: "role-title" },
              { id: "project-features", value: project.features, titleId: "features-title" },
              { id: "project-challenges", value: project.challenges, titleId: "challenges-title" },
              { id: "project-objectives", value: project.objectives, titleId: "objectives-title" },
              { id: "project-process", value: project.process, titleId: "process-title" },
              { id: "project-tech", value: project.tech, titleId: "tech-title" },
              { id: "project-impact", value: project.impact, titleId: "impact-title" }
            ];

            listFields.forEach(({ id, value, titleId }) => {
              const listElement = document.getElementById(id);
              if (Array.isArray(value) && value.length > 0) {
                listElement.innerHTML = "";
                value.forEach(item => {
                  const li = document.createElement("li");

                  if (typeof item === "object") {
                    if (item.image) {
                      const img = document.createElement("img");
                      img.src = item.image;
                      img.alt = "Related Image";
                      img.loading = "lazy";
                      img.classList.add("project-img");
                      li.appendChild(img);
                    }
                    if (item.description) {
                      const text = document.createElement("p");
                      text.innerText = item.description;
                      li.appendChild(text);
                    }
                  } else {
                    li.innerText = item;
                  }

                  listElement.appendChild(li);
                });

                document.getElementById(titleId).style.display = "block";
              } else {
                document.getElementById(titleId).style.display = "none";
              }
            });

            const designVersionsContainer = document.getElementById("project-versions");
            if (Array.isArray(project.design_versions) && project.design_versions.length > 0) {
              designVersionsContainer.innerHTML = "";

              project.design_versions.forEach(version => {
                const versionElement = document.createElement("li");

                if (version.image) {
                  const img = document.createElement("img");
                  img.src = version.image;
                  img.alt = version.description || "Design version";
                  img.loading = "lazy";
                  img.classList.add("design-version-img");
                  versionElement.appendChild(img);
                }

                const text = document.createElement("p");
                text.innerText = version.description;
                versionElement.appendChild(text);

                designVersionsContainer.appendChild(versionElement);
              });
              document.getElementById("versions-title").classList.remove("hidden");
            } else {
              document.getElementById("versions-title").classList.add("hidden");
            }


            // Handle "Preview" (Demo) Button
            const demoLink = document.getElementById("project-demo");
            if (project.demo && project.demo.trim() !== "") {
              demoLink.href = project.demo;
              demoLink.style.display = "inline-block";
            } else {
              demoLink.style.display = "none";
            }

            // Handle "Details" Button (Case Study or Report)
            const detailsLink = document.getElementById("project-details");
            if (project.details && project.details.trim() !== "") {
              detailsLink.href = project.details;
              detailsLink.style.display = "inline-block";


            }
          } else {
            document.getElementById("project-content").innerHTML = "<p>Project not found.</p>";
          }
        })
        .catch(error => console.error("Error loading project details:", error));

        
      // Fix Back to Top Button
      let backToTopButton = document.getElementById("back-to-top");
      if (!backToTopButton) {
        backToTopButton = document.createElement("button");
        backToTopButton.id = "back-to-top";
        backToTopButton.textContent = "↑ Back to Top";
        document.body.appendChild(backToTopButton);
      }
      // Style Back to Top Button
      Object.assign(backToTopButton.style, {
        position: "fixed",
        bottom: "20px",
        right: "20px",
        backgroundColor: "#007bff",
        color: "white",
        border: "none",
        padding: "12px 18px",
        fontSize: "16px",
        borderRadius: "5px",
        cursor: "pointer",
        opacity: "0",
        pointerEvents: "none",
        display: "none", // Ensure it's hidden initially
        transition: "opacity 0.3s ease-in-out"
      });


      // Scroll event to toggle visibility
      window.addEventListener("scroll", () => {
        if (window.scrollY > 300) {
          backToTopButton.style.display = "block"; // Ensure it becomes visible
          backToTopButton.style.opacity = "1";
          backToTopButton.style.pointerEvents = "auto";
        } else {
          backToTopButton.style.opacity = "0";
          backToTopButton.style.pointerEvents = "none";
          setTimeout(() => {
            if (window.scrollY <= 300) backToTopButton.style.display = "none";
          }, 300); // Hide completely after fade-out
        }
      });


      // Smooth scroll to top when clicked
      backToTopButton.addEventListener("click", () => {
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      // Fix Back Button
      document.getElementById("back-button").addEventListener("click", () => {
        window.history.back();
      });
    });

  </script>
</body>

</html>