<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Project Details</title>
  <link rel="stylesheet" href="project.css" />
</head>

<body>
  <button id="back-button">‚Üê Back</button>

  <div id="project-details">
    <h1 id="project-title"></h1>
    <img id="project-image" src="" alt="Project Image" style="display: none;" />

    <div id="project-content">
      <h2 id="overview-title" style="display: none;">Overview</h2>
      <p id="project-description"></p>

      <h2 id="role-title" style="display: none;">Role</h2>
      <ul id="project-role"></ul>

      <h2 id="features-title" style="display: none;">Key Features</h2>
      <ul id="project-features"></ul>

      <h2 id="challenges-title" style="display: none;">Challenges & Solutions</h2>
      <ul id="project-challenges"></ul>

      <h2 id="objectives-title" style="display: none;">Project Objectives</h2>
      <ul id="project-objectives"></ul>

      <h2 id="versions-title" class="hidden">Different Versions</h2>
      <ul id="project-versions"></ul>

      <h2 id="process-title" style="display: none;">Process & Approach</h2>
      <ul id="project-process"></ul>

      <h2 id="tech-title" style="display: none;">Programs</h2>
      <ul id="project-tech"></ul>

      <h2 id="impact-title" style="display: none;">Projected Impact</h2>
      <ul id="project-impact"></ul>

      <h2 id="date-title" style="display: none;">Project Date</h2>
      <p id="project-date"></p>
    </div>

    <div id="project-links">
      <a id="project-demo" href="#" target="_blank" style="display: none;">Demo</a>
      <a id="project-github" href="#" target="_blank" style="display: none;">GitHub</a>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const urlParams = new URLSearchParams(window.location.search);
      const projectId = parseInt(urlParams.get("id"), 10);

      console.log("Project ID from URL:", projectId); // Debugging

      fetch("db.json")
        .then(response => response.json())
        .then(data => {
          const project = data.projects.find(p => p.id === projectId);
          console.log("Project Data Loaded:", project); // Debugging

          if (project) {
            // Set Main Project Title
            document.getElementById("project-title").innerText = project.title || "No Title Available";

            // Handle Project Image (Lazy Load + Fallback)
            const projectImage = document.getElementById("project-image");
            if (project.image) {
              console.log("Project Image Path:", project.image);
              projectImage.src = project.image;
              projectImage.loading = "lazy";
              projectImage.style.display = "block";
            } else {
              console.warn("Missing Project Image! Using fallback.");
              projectImage.src = "Assets/default-placeholder.png";
              projectImage.style.display = "block";
            }

            // Handle Simple Text Fields (Overview & Date)
            const fields = [
              { id: "project-description", value: project.description, titleId: "overview-title" },
              { id: "project-date", value: project.date, titleId: "date-title" }
            ];

            fields.forEach(({ id, value, titleId }) => {
  if (value) {
    document.getElementById(id).innerText = value;
    document.getElementById(titleId).style.display = "block"; // Ensure header is displayed
  } else {
    document.getElementById(titleId).style.display = "none"; // Hide if no content
  }
});
            // Handle Lists with Images & Descriptions
            const listFields = [
              { id: "project-role", value: project.role, titleId: "role-title" },
              { id: "project-features", value: project.features, titleId: "features-title" },
              { id: "project-challenges", value: project.challenges, titleId: "challenges-title" },
              { id: "project-objectives", value: project.objectives, titleId: "objectives-title" },
              { id: "project-process", value: project.process, titleId: "process-title" },
              { id: "project-tech", value: project.tech, titleId: "tech-title" },
              { id: "project-impact", value: project.impact, titleId: "impact-title" }
            ];

            listFields.forEach(({ id, value, titleId }) => {
  const listElement = document.getElementById(id);
  if (Array.isArray(value) && value.length > 0) {
    listElement.innerHTML = "";
    value.forEach(item => {
      const li = document.createElement("li");

      if (typeof item === "object") {
        if (item.image) {
          const img = document.createElement("img");
          img.src = item.image;
          img.alt = "Related Image";
          img.loading = "lazy";
          img.classList.add("project-img");
          li.appendChild(img);
        }
        if (item.description) {
          const text = document.createElement("p");
          text.innerText = item.description;
          li.appendChild(text);
        }
      } else {
        li.innerText = item;
      }

      listElement.appendChild(li);
    });

    document.getElementById(titleId).style.display = "block"; // Show header when content exists
  } else {
    document.getElementById(titleId).style.display = "none"; // Hide if empty
  }
});


            // Handle Nested Titles (Design Versions)
            const designVersionsContainer = document.getElementById("project-versions");
            if (Array.isArray(project.design_versions) && project.design_versions.length > 0) {
              designVersionsContainer.innerHTML = "";
              project.design_versions.forEach(version => {
                const versionElement = document.createElement("li");
                versionElement.innerHTML = `<strong>${version.title}</strong>: ${version.description}`;
                designVersionsContainer.appendChild(versionElement);
              });
              document.getElementById("versions-title").classList.remove("hidden");
            } else {
              document.getElementById("versions-title").classList.add("hidden");
            }

            // Set Links (Ensure visibility)
            const demoLink = document.getElementById("project-demo");
            if (project.demo) {
              demoLink.href = project.demo;
              demoLink.classList.remove("hidden");
            } else {
              demoLink.classList.add("hidden");
            }

            const githubLink = document.getElementById("project-github");
            if (project.github) {
              githubLink.href = project.github;
              githubLink.classList.remove("hidden");
            } else {
              githubLink.classList.add("hidden");
            }
          } else {
            document.getElementById("project-content").innerHTML = "<p>Project not found.</p>";
          }
        })
        .catch(error => console.error("Error loading project details:", error));

      // üîπ Back to Top Button Functionality (Smooth Fade-in & Out)
      const backToTopButton = document.createElement("button");
      backToTopButton.id = "back-to-top";
      backToTopButton.textContent = "‚Üë Back to Top";
      document.body.appendChild(backToTopButton);

      // Style Back to Top Button via JS
      Object.assign(backToTopButton.style, {
        position: "fixed",
        bottom: "20px",
        right: "20px",
        backgroundColor: "#007bff",
        color: "white",
        border: "none",
        padding: "12px 18px",
        fontSize: "16px",
        borderRadius: "5px",
        cursor: "pointer",
        opacity: "0",
        pointerEvents: "none",
        transition: "opacity 0.3s ease-in-out"
      });

      window.addEventListener("scroll", () => {
        if (window.scrollY > 300) {
          backToTopButton.style.opacity = "1";
          backToTopButton.style.pointerEvents = "auto";
        } else {
          backToTopButton.style.opacity = "0";
          backToTopButton.style.pointerEvents = "none";
        }
      });

      backToTopButton.addEventListener("click", () => {
        window.scrollTo({ top: 0, behavior: "smooth" });
      }, { once: true });

      // üîπ Back Button Functionality (Ensures One-time Execution)
      document.getElementById("back-button").addEventListener("click", () => {
        window.history.back();
      }, { once: true });
    });
  </script>


  <button id="back-to-top">‚Üë Back to Top</button>
</body>

</html>